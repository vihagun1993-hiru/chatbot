<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chatty â€“ HR Engagement Assistant</title>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <style>
    :root {
      --bg: #f0f4f8;
      --card: #ffffff;
      --bot: #e1ffc7;
      --user: #dcf8c6;
      --primary: #0077cc;
      --primary-dark: #005fa3;
      --text: #333;
    }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 0; }
    #welcome { text-align: center; padding: 50px 20px; }
    #chatbox { display: none; max-width: 800px; margin: 20px auto; padding: 20px; background: var(--card); border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
    .message { margin: 12px 0; padding: 12px 14px; border-radius: 18px; max-width: 80%; font-size: 15px; line-height: 1.5; }
    .bot { background: var(--bot); color: var(--text); text-align: left; }
    .user { background: var(--user); color: #000; text-align: right; margin-left: auto; }
    .options { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .options button { padding: 10px 14px; border: none; background: var(--primary); color: white; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
    .options button:hover { background: var(--primary-dark); }
    input[type="text"] { width: 100%; padding: 10px; margin-top: 12px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 15px; }
    button#startBtn { padding: 12px 22px; font-size: 16px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; }
    button#startBtn:hover { background: var(--primary-dark); }
    .assistant-wrap { display: inline-block; position: relative; }
    lottie-player { width: 220px; height: 220px; }
    .assistant-bubble {
      position: absolute; left: 50%; transform: translateX(-50%);
      bottom: -16px; background: #fff; color: #333; border: 1px solid #ccc;
      border-radius: 12px; padding: 8px 10px; font-size: 13px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      white-space: nowrap;
    }
    .rating { display: flex; gap: 6px; margin-top: 10px; }
    .rating button { font-size: 18px; padding: 8px 10px; background: #ffd166; color: #333; border-radius: 6px; border: none; cursor: pointer; }
    .rating button:hover { background: #f4a261; color: #fff; }
  </style>
</head>
<body>

<div id="welcome">
  <div class="assistant-wrap">
    <lottie-player src="Chat Bot Test.json" background="transparent" speed="1" loop autoplay></lottie-player>
    <div class="assistant-bubble">Do you have any questions? Then letâ€™s talk!</div>
  </div>
  <h2>Welcome to Chatty ðŸ’»</h2>
  <p>Hi there! Welcome to <strong>NovaTech Solutions Pvt. Ltd.</strong> â€” a fast-growing IT service provider in Colombo.</p>
  <button id="startBtn" onclick="startChat()">Letâ€™s Chat</button>
</div>

<div id="chatbox">
  <div id="messages"></div>
  <div id="inputArea"></div>
</div>

<script>
/* === Chatbot Flow Logic === */

function handleOption(choice){
  showMessage(choice,"user");

  // Greeting menu
  if(currentStep==="greeting"){
    switch(choice){
      case "Employee engagement activities":
        showMessage("Are you aware of the employee engagement programs we currently offer?","bot");
        showOptions(["Yes","No"]);
        currentStep="engagementQ1"; break;
      case "Employee feedback":
        showMessage("Do you want to provide feedback as anonymous?","bot");
        showOptions(["Yes","No"]);
        currentStep="feedbackQ1"; break;
      case "Rewards & recognition":
        showMessage("Do you feel your contributions are recognized at work?","bot");
        showOptions(["Yes","No"]);
        currentStep="recognitionQ1"; break;
      case "Career development":
        showMessage("Are you satisfied with the career growth opportunities present here?","bot");
        showOptions(["Yes","No"]);
        currentStep="careerQ1"; break;
      case "Retention concerns":
        showMessage("Are you presently satisfied with your work environment?","bot");
        showOptions(["Yes","No"]);
        currentStep="retentionQ1"; break;
      case "Other HR inquiries":
        showMessage("Please describe your HR inquiry:","bot");
        showInput("Type your inquiry...","handleManual");
        currentStep="otherInquiryManual"; break;
    }
  }

  /* === Engagement Flow === */
  else if(currentStep==="engagementQ1"){
    if(choice==="Yes"){
      showMessage("Recently, have you been involved in any engagement activities?","bot");
      showOptions(["Yes","No"]);
      currentStep="engagementQ2";
    } else {
      showMessage("No worries! We have monthly team-building, wellbeing workshops, sports day, recognition ceremonies. Would you like to know about upcoming events or how to participate?","bot");
      showOptions(["Coming events","How to participate"]);
      exitFlow();
    }
  }
  else if(currentStep==="engagementQ2"){
    if(choice==="Yes"){
      showMessage("Did this activity enhance team connectedness and motivation?","bot");
      showOptions(["Yes","None"]);
      currentStep="engagementQ3";
    } else {
      showMessage("That's fine; many skip due to workload. Do you want virtual, outdoor, or skill-based activities?","bot");
      showOptions(["Virtual","Outdoor","Skill-based"]);
      exitFlow();
    }
  }
  else if(currentStep==="engagementQ3"){
    if(choice==="Yes"){
      showMessage("Great to hear! Would you like to share feedback or get recommendations for upcoming events?","bot");
      showOptions(["Share feedback","Get recommendations"]);
      exitFlow();
    } else {
      showMessage("Thanks for your honesty! Why didn't it meet expectations?","bot");
      showOptions(["Poor coordination","Not relevant to my interests","Timing issues","Prefer different types"]);
      exitFlow();
    }
  }

  /* === Feedback Flow === */
  else if(currentStep==="feedbackQ1"){
    if(choice==="Yes"){
      showMessage("Your identity will not be recorded. Please type your feedback:","bot");
      showInput("Enter feedback...","handleManual");
      currentStep="feedbackAnonymous";
    } else {
      showMessage("Great, I'll attach your name so HR can follow up. What feedback would you like to share?","bot");
      showInput("Enter feedback...","handleManual");
      currentStep="feedbackNamed";
    }
  }

  /* === Recognition Flow === */
  else if(currentStep==="recognitionQ1"){
    if(choice==="Yes"){
      showMessage("Great! Recognition motivates employees. Would you like to nominate a colleague?","bot");
      showOptions(["Yes","No"]);
      currentStep="recognitionNominate";
    } else {
      showMessage("What kind of recognition would you prefer?","bot");
      showOptions(["Public recognition","Monetary rewards","Appreciation messages","Career development opportunities"]);
      exitFlow();
    }
  }
  else if(currentStep==="recognitionNominate"){
    if(choice==="Yes"){
      showMessage("Please enter the colleague's name:","bot");
      showInput("Nominee name...","handleManual");
      currentStep="recognitionNominationName";
    } else { exitFlow(); }
  }

  /* === Career Development Flow === */
  else if(currentStep==="careerQ1"){
    if(choice==="Yes"){
      showMessage("Great to hear! Would you like recommendations for skill development programs or internal job openings?","bot");
      showOptions(["Skill development","Job openings"]);
      exitFlow();
    } else {
      showMessage("Which area do you want to develop more?","bot");
      showOptions(["Leadership","Technical skills","Communication","Soft skills","Cross-functional experience"]);
      currentStep="careerQ2";
    }
  }
  else if(currentStep==="careerQ2"){
    showMessage("Would you be interested in exploring training programs related to your chosen field?","bot");
    showOptions(["Yes","No"]);
    currentStep="careerQ3";
  }
  else if(currentStep==="careerQ3"){
    if(choice==="Yes"){
      showMessage("Sure, I'll list the available training sessions that match your goals.","bot");
      exitFlow();
    } else {
      showMessage("Alright; no problem! Whenever you change your mind, just let me know.","bot");
      exitFlow();
    }
  }

  /* === Retention Flow === */
  else if(currentStep==="retentionQ1"){
    if(choice==="Yes"){
      showMessage("Ah, glad to hear that! Positive work environments build engagement.","bot");
      exitFlow();
    } else {
      showMessage("What area causes dissatisfaction?","bot");
      showOptions(["Workload","Work-life balance","Salary & benefits","Management support","Career growth"]);
      currentStep="retentionQ2";
    }
  }
  else if(currentStep==="retentionQ2"){
    showMessage("Would you like HR to follow up with you?","bot");
    showOptions(["Yes","No"]);
    currentStep="retentionQ3";
  }
  else if(currentStep==="retentionQ3"){
    if(choice==="Yes"){
      showMessage("Sure, I will forward your concern to HR, and they will respond confidentially.","bot");
      exitFlow();
    } else {
      showMessage("Understood! I'm here any time you need to talk.","bot");
      exitFlow();
    }
  }

  /* === Final Exit === */
  else if(currentStep==="finalExit"){
    if(choice==="Yes"){
      showMessage("Back to main menu: What would you like help with today?","bot");
      showOptions(["Employee engagement activities","Employee feedback","Rewards & recognition","Career development","Retention concerns","Other HR inquiries"]);
      currentStep="greeting";
    } else {
      showMessage("Thank you for chatting!","bot");
      showRating();
    }
  }
}

/* === Exit Flow Helper === */
function exitFlow(){
  showMessage("Is there anything else I can help you with?","bot");
  showOptions(["Yes","No"]);
  currentStep="finalExit";
}

/* === Rating System === */
function showRating(){
  if(ratingGiven) return;
  const area=document.getElementById("inputArea");
  area.innerHTML="";
  const ratingDiv=document.createElement("div");
  ratingDiv.className="rating";
  ["â­","â­â­","â­â­â­","â­â­â­â­","â­â­â­â­â­"].forEach(s=>{
    const btn=document.createElement("button");
    btn.innerText=s;
    btn.onclick=()=>{
      if(!ratingGiven){
        showMessage(s,"user");
        showMessage("Thanks for your "+s+" rating!","bot");
        ratingGiven=true;
        // Ask another question button
        const again=document.createElement("button");
        again.innerText="Ask another question";
        again.onclick=()=>{
          ratingGiven=false;
          showMessage("What would you like help with today?","bot");
          showOptions(["Employee engagement activities","Employee feedback","Rewards & recognition","Career development","Retention concerns","Other HR inquiries"]);
          currentStep="greeting";
        };
        area.innerHTML="";
        area.appendChild(again);
      }
    };
    ratingDiv.appendChild(btn);
  });
  area.appendChild(ratingDiv);
}
